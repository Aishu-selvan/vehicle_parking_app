<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lot Panel | Parking App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <style>
    body {
      background: #ecf2f8;
    }
    .lot-card {
      border-radius: 14px;
      box-shadow: 0 2px 12px #b9d0e822;
      background: #fff;
    }
    .spot-icon {
      width: 36px;
      height: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      border-radius: 8px;
      font-weight: bold;
      margin: 2px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .spot-icon:hover {
      transform: scale(1.1);
    }
    .spot-A {
      background: #e2fde1;
      color: #34b233;
      border: 1px solid #aae7a5;
    }
    .spot-O {
      background: #fde1e1;
      color: #d70000;
      border: 1px solid #eab1b1;
    }
  </style>
</head>
<body>
  <div class="container mt-3">
    <h3 class="mb-2 text-primary">
      <i class="bi bi-kanban-fill"></i> Lot Panel      
    </h3>
    <div>
      <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary mb-3">
        <i class="bi bi-arrow-left"></i> Back
      </a>
    </div>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for msg in messages %}
            <div class="alert alert-warning">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

    <!-- Search Form -->
    <form method="post" class="row mb-3 g-2 align-items-end">
      <div class="col-sm-4">
        <label for="user_id" class="form-label mb-0">Search by User ID/Username</label>
        <input
          type="text"
          id="user_id"
          name="user_id"
          class="form-control"
          placeholder="User ID or Email"
          value="{{ user_search|default('') }}"
        />
      </div>
      <div class="col-sm-5">
        <label for="address" class="form-label mb-0">Search Address/Area</label>
        <input
          type="text"
          id="address"
          name="address"
          class="form-control"
          placeholder="Enter location or pincode"
          value="{{ addr_search|default('') }}"
        />
      </div>
      <div class="col-sm-3">
        <button class="btn btn-primary w-100 mt-2" type="submit">
          <i class="bi bi-search"></i> Search
        </button>
      </div>
    </form>

    <!-- Lots Grid -->
    <div class="row gy-4">
      {% for lot in lots %}
      <div class="col-md-6 col-lg-4">
        <div class="lot-card p-4 mb-3">
          <div class="mb-2 fs-5 fw-semibold text-primary">{{ lot.prime_location_name }}</div>
          <div class="mb-1 text-secondary">{{ lot.address }}</div>
          <div class="mb-2">
            <span class="badge bg-info">Pincode: {{ lot.pin_code }}</span>
            <span class="badge bg-success">â‚¹{{ lot.price }}/hr</span>
            <span class="badge bg-dark">{{ lot.spots|length }} spots</span>
          </div>

          <!-- Parking Spots Icons -->
          <div class="d-flex flex-wrap align-items-center mb-2">
            {% for spot in lot.spots %}
              <a href="{{ url_for('admin.spot_detail', spot_id=spot.id) }}" class="text-decoration-none" title="Spot ID: {{ spot.id }} - {% if spot.status == 'A' %}Available{% else %}Occupied{% endif %}">
                {% if spot.status == 'A' %}
                  <span class="spot-icon spot-A">
                    <i class="bi bi-circle-fill"></i> A
                  </span>
                {% else %}
                  <span class="spot-icon spot-O">
                    <i class="bi bi-x-circle-fill"></i> O
                  </span>
                {% endif %}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
      {% else %}
      <div class="col-12 text-center text-muted">No parking lots found.</div>
      {% endfor %}
    </div>
  </div>
</body>
</html>
